apiVersion: v1
kind: Namespace
metadata:
  annotations:
    argocd.argoproj.io/sync-options: Prune=false
    argocd.argoproj.io/sync-wave: "-5"
    product: {{ .Values.product.name }}
    env: {{ .Values.env }}
  name: {{ .Values.product.name }}-{{ .Values.env }}
---
apiVersion: argoproj.io/v1alpha1
kind: AppProject
metadata:
  annotations:
    argocd.argoproj.io/sync-options: PruneLast=true
    argocd.argoproj.io/sync-wave: "-2"
  name: {{ .Values.product.name }}-{{ .Values.env }}
  namespace: argo
spec:
  description: {{ .Values.product.description }}
  sourceRepos:
  - '*'
  destinations:
  - server: https://kubernetes.default.svc
    name: in-cluster
    namespace: {{ .Values.product.name }}-*
  clusterResourceWhitelist:
  - group: '*'
    kind: '*'
  namespaceResourceWhitelist:
  - group: '*'
    kind: '*'
